(()=>{"use strict";var e={n:i=>{var t=i&&i.__esModule?()=>i.default:()=>i;return e.d(t,{a:t}),t},d:(i,t)=>{for(var l in t)e.o(t,l)&&!e.o(i,l)&&Object.defineProperty(i,l,{enumerable:!0,get:t[l]})},o:(e,i)=>Object.prototype.hasOwnProperty.call(e,i)};const i=jQuery;var t=e.n(i);const l="jqueryUploader",r="defaultUploaderOptions",s="file-remove",o=".jquery-uploader-preview-progress",a="image",n="other",d=["jpg","png","jpeg","gif","bmp"],h=function(){const e=window.URL||window.webkitURL;let i=new Map;return{createBlobUrl:function(t){let l=e.createObjectURL(t);return i.set(l,t),l},revokeBlobUrl:function(t){e.revokeObjectURL(t),i.delete(t)},getBlobFromUrl:function(e){return i.get(e)}}}();function u(){let e=[],i="0123456789abcdef";for(let t=0;t<36;t++)e[t]=i.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=i.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function p(e){if(!e||0===e.length)return n;if(e.startsWith("blob"))return-1!==h.getBlobFromUrl(e).type.indexOf("image")?a:n;for(let i of d)if(e.endsWith(i))return a;return n}class f{constructor(e,i){this.$originEle=e;let l=window[r]?window[r]:{};this.options=t().extend(!0,{},f.defaults,l,i),this.id=u(),this.files=[],this.checkOptions(),this.initEle(),this.initEvent()}checkOptions(){if(this.options.mode!==f.mode.url)throw`暂不支持的模式 ${this.options.mode}`;if("text"!==this.$originEle.attr("type")&&this.$originEle.attr("type"))throw`url模式下，元素的类型只能为 text,不能为 ${this.$originEle.attr("type")}`;this.$originEle[0].hasAttribute("readonly")||this.$originEle[0].hasAttribute("disabled")||this.options.readonly?(this.options.readonly=!0,this.$originEle.val()||this.options.defaultValue&&0!==this.options.defaultValue.length||console.error("只读模式的值不能为空")):this.options.readonly=!1,this.options.allowFileExt=this.options.allowFileExt||this.$originEle[0].getAttribute("accept"),this.options.maxLength||(this.options.maxLength=Number.MAX_VALUE)}initEle(){if(this.$originEle.css("display","none"),this.$selectCard=t()('<div class="jquery-uploader-select-card">\n                <div class="jquery-uploader-select">\n                    <div class="upload-button">\n                        <i class="fa fa-plus"></i><br/>\n                        <a>上传</a>\n                    </div>\n                </div>\n            </div>'),this.$uploaderContainer=t()('<div class="jquery-uploader-preview-container"></div>'),this.$uploader=t()('<div class="jquery-uploader"></div>').append(this.$uploaderContainer),this.options.parent?this.options.parent.append(this.$uploader):this.$originEle.parent().append(this.$uploader),this.options.mode===f.mode.url){let e=this.$originEle.val();this.createDefaultFiles(e)}this.$originEle.trigger("uploader-init")}createFileCardEle(e,i,l){let r=l===a?`<img alt="preview" class="files_img" src="${i}"/>`:'<div class="file_other"></div>',s="",n="";window.Viewer&&"function"==typeof window.Viewer&&l===a&&(s='<li class="file-view"><i class="fa fa-eye"></i></li>'),this.options.readonly||(n='<li class="file-delete"><i class="fa fa-trash-o"></i></li>');let d=t()(`<div class="jquery-uploader-card" id="${e}">\n                    <div class="jquery-uploader-preview-main">\n                        <div class="jquery-uploader-preview-action">\n                            <ul>\n                                ${s}\n                                ${n}\n                            </ul>\n                        </div>\n                        <div class="jquery-uploader-preview-progress">\n                            <div class="progress-mask"></div>\n                            <div class="progress-loading">\n                                <i class="fa fa-spinner fa-spin"></i>\n                            </div>\n                        </div>\n                        ${r}\n                    </div>\n                 </div>`);return d.find(o).hide(),d}fileCardWaring(e){e.css("box-shadow","0px 0px 3px 1px #f8ac59 inset")}fileCardError(e){e.css("box-shadow","0px 0px 3px 1px #ed5565 inset")}fileCardDefault(e){e.css("box-shadow","")}upload(){return this.handleFileUpload(),this.$originEle}removeFiles(...e){if(!e||0===e.length)return console.error("删除文件的请求参数有误"),[];let i=[];for(let t of e){let e=-1;for(let i=0;i<this.uploadFiles().length;i++)this.files[i].id===t&&(e=i);if(-1!==e){let t=this.files.splice(e,1);t[0].url&&h.revokeBlobUrl(t[0].url),i.push(t[0])}else console.error(`删除错误 id ${t} 不存在`)}return this.$originEle.trigger(s,...i),this.refreshPreviewFileList(),this.refreshValue(),i}clean(){return this.files=[],this.refreshPreviewFileList(),this.refreshValue(),this.$originEle}uploadFiles(){return this.files}initEvent(){}refreshValue(){let e=this.$originEle.val(),i=[];this.files.forEach((e=>{e.status!==f.fileStatus.uploaded&&e.status!==f.fileStatus.initial||i.push(e.url)}));let t=i.join(",");e!==t&&this.$originEle.val(t).trigger("change")}refreshPreviewFileList(){this.$uploaderContainer.empty(),this.files.forEach((e=>{this.$uploaderContainer.append(e.$ele),e.$ele.find(".jquery-uploader-preview-action .file-delete").on("click",this.handleFileDelete.bind(this)),e.$ele.find(".jquery-uploader-preview-action .file-view").on("click",this.handleFileView.bind(this))}));let e=!1;(this.options.multiple||0===this.files.length)&&!this.options.readonly&&this.files.length<this.options.maxLength&&(e=!0),e&&(this.$uploaderContainer.append(this.$selectCard),this.$selectCard.on("click",this.handleFileSelect.bind(this)),this.$selectCard.on("dragover",(e=>{e.originalEvent.preventDefault(),this.$selectCard.addClass("dragover")})),this.$selectCard.on("dragenter",(()=>this.$selectCard.addClass("dragover"))),this.$selectCard.on("dragleave",(()=>this.$selectCard.removeClass("dragover"))),this.$selectCard.on("dragend",(()=>this.$selectCard.removeClass("dragover"))),this.$selectCard.on("drop",(e=>{e.originalEvent.preventDefault(),this.$selectCard.removeClass("dragover"),this.handleFileDrop(e.originalEvent)})))}createDefaultFiles(e){let i=[];this.options.defaultValue?i=this.options.defaultValue:e&&(this.options.multiple?e.split(","):[e]).forEach(((e,t)=>{let l=p(e);i.push({name:"default"+t,type:l,url:e})})),i.forEach((e=>{let i=u();e.type||(e.type=p(e.url));let t=this.createFileCardEle(i,e.url,e.type);this.files.push({id:i,type:e.type,name:e.name,url:e.url,status:f.fileStatus.initial,file:null,$ele:t})})),this.refreshPreviewFileList(),this.refreshValue()}onFileUploadUpdate(e,i){e.$ele.find(".jquery-uploader-preview-progress > .progress-mask").css("height",100-i+"%")}onFileUploadSuccess(e,i){let t;this.$originEle.trigger("upload-success",e,i),e.$ele.find(o).hide(),e.$ele.find(".jquery-uploader-preview-action").show();try{if(t=this.options.ajaxConfig.responseConverter(e,i),!t.url)return console.error("数据格式错误，没有url字段"),void this.onFileUploadError(e,"数据格式错误，没有url字段")}catch(i){return console.error("数据转换异常",i),void this.onFileUploadError(e,"数据转换异常")}e.url&&e.url.startsWith("blob")&&h.revokeBlobUrl(e.url),e.name=t.name||e.name,e.url=t.url,e.status=f.fileStatus.uploaded,e.$ele.find(".jquery-uploader-preview-main > img").attr("src",e.url),this.refreshPreviewFileList(),this.refreshValue()}onFileUploadError(e,i){this.$originEle.trigger("upload-error",e,i),e.status=f.fileStatus.error,e.$ele.find(o).hide(),e.$ele.attr("title",i),this.fileCardError(e.$ele)}handleFileSelect(){t()(`<input type="file" ${this.options.multiple?"multiple":""} ${this.options.allowFileExt?'accept="'+this.options.allowFileExt+'"':""}/>`).on("change",(e=>{this.handleFileAdd(e.target.files)})).click()}handleFileDrop(e){0!==e.dataTransfer.files.length?this.handleFileAdd(e.dataTransfer.files):alert("drop files is empty")}checkFileExt(e){if(!this.options.allowFileExt)return!0;let i=e.name,t=i.substring(i.lastIndexOf(".")).toLowerCase();return!!this.options.allowFileExt.toLowerCase().split(",").includes(t)||(alert("file type not allow"),!1)}handleFileAdd(e){if(!e||0===e.length)return;this.options.multiple||(e=[e[0]]);let i=[];for(let t=0;t<e.length;t++){let l=e[t];if(!this.checkFileExt(l))continue;let r=-1!==l.type.indexOf("image")?a:n,s=h.createBlobUrl(l),o=u(),d=this.createFileCardEle(o,s,r);this.fileCardWaring(d),i.push({id:o,type:r,name:l.name,url:s,status:f.fileStatus.selected,file:l,$ele:d})}this.options.maxLength&&i.length+this.files.length>this.options.maxLength?alert(`cannot exceed the maximum allowed ${this.options.maxLength} files`):(this.files.push(...i),this.refreshPreviewFileList(),this.$originEle.trigger("file-add",i),!0===this.options.autoUpload&&this.handleFileUpload())}handleFileUpload(){let e=[];this.files.forEach((i=>{i.status===f.fileStatus.selected&&e.push(i)})),this.$originEle.trigger("before-upload",e),e.forEach((e=>{this.$originEle.trigger("uploading",e);try{this.fileCardDefault(e.$ele),e.$ele.find(o).show(),this.options.ajaxConfig.ajaxRequester(this.options.ajaxConfig,e,(i=>{this.onFileUploadUpdate(e,i)}),(i=>{this.onFileUploadSuccess(e,i)}),(i=>{this.onFileUploadError(e,i)}))}catch(i){this.onFileUploadError(e,"ajax请求异常")}}))}handleFileDelete(e){let i=t()(e.target).parents(".jquery-uploader-card"),l=i[0].id;i.remove();let r=-1;this.files.forEach(((e,i)=>{e.id===l&&(r=i)}));let o=this.files.splice(r,1);o[0].url&&h.revokeBlobUrl(o[0].url),this.$originEle.trigger(s,...o),this.refreshValue(),this.refreshPreviewFileList()}handleFileView(e){let i=t()(e.target).parents(".jquery-uploader-card")[0].id,l=null;this.viewer&&this.viewer.destroy(),t()("#viewer-"+this.id).remove();let r=t()(`<div style="display: none" id="viewer-${this.id}"></div>`);if(this.files.forEach((e=>{e.id===i&&(l=e),e.type===a&&r.append(t()(`<img id="img-${e.id}" src="${e.url}" alt="${e.name}"/>`))})),!l)throw"error,file data not found";t()(document.body).append(r),this.viewer=new window.Viewer(document.getElementById("viewer-"+this.id)),t()("#img-"+l.id).click()}}f.config={paramsBuilder:function(e){let i=new FormData;return i.append("file",e.file),i},responseConverter:function(e,i){return{url:i.data,name:null}},ajaxRequester:function(e,i,l,r,s){t().ajax({url:e.url,contentType:!1,processData:!1,method:e.method,data:e.paramsBuilder(i),success:function(e){r(e)},error:function(e){console.error("上传异常",e),s("上传异常")},xhr:function(){let e=new XMLHttpRequest;return e.upload.addEventListener("progress",(function(e){let i=e.loaded/e.total*100;l(i)})),e}})}},f.mode={url:"url",file:"file",custom:"custom"},f.fileStatus={selected:"selected",uploading:"uploading",uploaded:"uploaded",error:"error",initial:" initial"},f.defaults={readonly:!1,mode:f.mode.url,multiple:!1,defaultValue:null,parent:null,allowFileExt:null,maxLength:null,autoUpload:!0,ajaxConfig:{url:"",method:"post",paramsBuilder:f.config.paramsBuilder,ajaxRequester:f.config.ajaxRequester,responseConverter:f.config.responseConverter}},$.fn.uploader=function(e,...i){if("string"==typeof e){let t=$(this[0]).data(l);if(!t)throw"this is not a uploader instance";return t[e](...i)}return this.each((function(){let i=$(this),t=i.data(l);t||(t=new f(i,e||{}),i.data(l,t))}))},$.fn.uploaderSetup=function(e){window[r]=e},$.Uploader=f})();